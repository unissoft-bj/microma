!function(e,t,o,i){"use strict";var a=e.isSupportTouch?"tap":"click",n=window.LS;i.Base.Event.extend("Page.COMS.PT.Pool",{config:{gameCore:null,periodUrl:"/t/get_period.html",betPageUrl:"",payUrl:"/t/pay/order.html"},init:function(t){this.initConfig(t);this.initCache();this.initPool();this.initCountDown();this.loadData();this.initEvent();if("true"!==e.cookie(o.gameEn+"ZiXuan"))this.cache.$goBackBtn.attr("cpurl","/t/index.html");this.cache.$rightBox.attr("cpurl",e.addUrlPara(this.cache.$rightBox.attr("cpurl"),"backupUrl="+encodeURIComponent(location.href)));i.Widgets.Keyboard.create()},initConfig:function(t){this.config=e.extend({},this.config,t);var i=e.getPara("activityType");if(i){this.config.activityType=i;this.config.betPageUrl=e.addUrlPara(this.config.betPageUrl,"activityType="+i)}this.config.payUrl=this.config.payUrl+"?backUrl="+encodeURIComponent(this.config.betPageUrl);this.config.poolNumKey=o.gameEn+"PoolNum";this.config.selectNumKey=o.gameEn+"SelectNum"},initCache:function(){var t={};t.$wrap=e("#wrap");t.$header=e("#header");t.$banner=e(".gameBanner");t.$ctrl=e("#ctrl");t.$bottom=e("#bottom");t.$scroller=e(".scroller");t.$betBoxWrap=e(".betBoxWrap");t.$betBox=e(".betBox");t.$pullState=e(".pullState");t.$pullDown=e(".pullDown");t.$pullUp=e(".pullUp");t.$pullHolder=e(".pullHolder");t.$payBtn=e("#payBtn");t.$betTimesInput=e("#betTimesInput");t.$followTimesInput=e("#followTimesInput");t.$selfSelectBtn=e("#selfSelectBtn");t.$randomBtn=e("#randomBtn");t.$clearBtn=e("#clearBtn");t.$goBackBtn=e(".goBack");t.pullOffset=10;t.$rightBox=e(".rightBox");t.$betResultWrap=e(".betResult");t.$cartKeyboardOverlay=e(".cartKeyboardOverlay");t.$additionForFollowTimes=e(".additionForFollowTimes");t.$additionForBetTimes=e(".additionForBetTimes");t.$rightBox=e(".rightBox");this.cache=t},initPool:function(){var t=this,i=t.config,a;a=e.extend({},i.gameCore,{edit:function(a,l){var r=t.betPool;l=i.gameCore.serialize([l.slice(0,2)]);n.set(i.selectNumKey,l);r.del(a);e.cookie(o.gameEn+"ZiXuan","true",{expires:5*365});window.location.href=i.betPageUrl}});this.betPool=o.createCom("COMS.PT.BetPool",a);this.betPool.onChange(function(){t.refreshScroll();t.updateInfo();t.saveData()})},initCountDown:function(){var i=this.cache,a,n;t.get(this.config.periodUrl,{gameEn:o.gameEn},function(o,l){if(o);else{a=+new Date;l=t.parseJSON(l);if(1===+l.status){i.period=l.period;i.timeLeft=1e3*+l.timeLeft;i.nextOpenSecs=1e3*+l.nextOpenSecs;i.countDownTimer=setInterval(function(){if(i.nextOpenSecs>=0){n=+new Date;if(i.timeLeft>0)i.timeLeft-=n-a;i.nextOpenSecs-=n-a;a=n}else{clearInterval(i.countDownTimer);if(l.timeLeft>0&&l.nextOpenSecs>0)window.location.reload(true)}},500)}else{i.stopSale=true;e.alert("当前期次已截止，请等待下期")}}})},initEvent:function(){var t=this,i=this.cache;i.$randomBtn[a](function(){t.betPool.random(1)});i.$selfSelectBtn[a](function(){e.cookie(o.gameEn+"ZiXuan","true",{expires:5*365});document.location.replace(t.config.betPageUrl)});i.$clearBtn[a](function(){var o=t.betPool.getData();if(o.length>0)e.confirm("确定要清空选号？",function(e){if(e)t.betPool.clear()})});i.$payBtn[a](function(){t.pay()});e([i.$followTimesInput[0],i.$betTimesInput[0]]).on("keyboard:open",e.proxy(this.keyboardOpen,this)).on("keyboard:close",e.proxy(this.keyboardClose,this)).on("keyboard:change",e.proxy(this.keyboardChange,this));i.$additionForFollowTimes.find("li[data-value]").click(e.proxy(this.setFollowTimes,this));i.$additionForBetTimes.find("a[data-value]").click(e.proxy(this.setBetTimes,this));i.$bottom.find(".questionMark").click(function(t){t.stopPropagation();t.preventDefault();setTimeout(function(){e.dialog({title:"什么是中奖后停止追号？",content:"勾选后，当您的追号方案某一期中奖，则后续的追号订单将被撤销，资金返还到您的账户中。如不勾选，系统一直帮你购买所有的追号投注订单。",button:["我知道了"]})},300);return false});document.addEventListener("DOMContentLoaded",function(){window.setTimeout(function(){t.reLayout();t.refreshScroll()},300)},false);e(window).resize(function(){t.reLayout()}).on("ortchange",function(e){t.reLayout()});i.$wrap[0].addEventListener("touchmove",function(e){e.preventDefault()},false)},reLayout:function(){var t=this.cache,o=t.$wrap,i=t.$bottom,a=t.$header.height()+t.$banner.height()+t.$ctrl.height(),n=i.height(),l=window.innerHeight;o.height(l-n-a).css("overflow","hidden");i.css({top:o.height()+a+"px",left:"0px"});if(!this.iScroll){this.iScroll=new window.IScroll(o[0],{preventDefault:false,probeType:2});this.checkPullRandom=e.proxy(this.checkPullRandom,this);this.changePullState=e.proxy(this.changePullState,this);this.iScroll.on("scrollEnd",this.checkPullRandom);this.iScroll.on("scroll",this.changePullState)}else this.iScroll.refresh()},refreshScroll:function(){var e=this.cache,t=this.betPool.getCount()[0];if(t>0){e.$pullHolder.hide();e.$betBox.show()}else{e.$pullHolder.show();e.$betBox.hide()}if(e.$betBox.height()>e.$wrap.height())e.$betBoxWrap.height("auto");else e.$betBoxWrap.height(e.$wrap.height()+1);this.iScroll&&this.iScroll.refresh()},checkPullRandom:function(){var e=this.cache;if(e.scrollNum>=e.pullOffset)this.betPool.random();e.$pullDown.show();e.$pullUp.hide();e.scrollNum=-1},changePullState:function(){var e=this.cache;if(this.iScroll.y>=e.pullOffset){e.$pullDown.hide();e.$pullUp.show()}else{e.$pullDown.show();e.$pullUp.hide()}e.scrollNum=this.iScroll.y},saveData:function(){var e=this.betPool.serialize();if(e)n.set(this.config.poolNumKey,e);else n.remove(this.config.poolNumKey)},loadData:function(){var e=this.config,t=n.get(e.poolNumKey),o=n.get(e.selectNumKey),i=e.gameCore;if(t)try{this.betPool.push2(i.parse(t))}catch(a){n.remove(e.poolNumKey)}if(o){try{this.betPool.push2(i.parse(o))}catch(a){}n.remove(e.selectNumKey)}},updateInfo:function(){var e=this.cache,t=+e.$betTimesInput.attr("data-value")||1,o=+e.$followTimesInput.attr("data-value")||1,i=this.betPool.getCount()[1],a=i*t*o;e.$payBtn.html(a>0?"<span>立即付款</span>"+a+"元":"至少选择一注幸运号码")},keyboardOpen:function(e){var t=this.cache;if(e.target===t.$followTimesInput[0]){t.$additionForFollowTimes.show();t.$additionForBetTimes.hide();t.$followTimesInput.addClass("active");t.$betTimesInput.removeClass("active")}else{t.$additionForFollowTimes.hide();t.$additionForBetTimes.show();t.$followTimesInput.removeClass("active");t.$betTimesInput.addClass("active")}t.$betResultWrap.hide();t.$bottom.css({top:window.innerHeight-t.$bottom.height()});t.$cartKeyboardOverlay.show()},keyboardClose:function(){var e=this.cache;e.$additionForFollowTimes.hide();e.$additionForBetTimes.hide();e.$followTimesInput.removeClass("active");e.$betTimesInput.removeClass("active");e.$betResultWrap.show();e.$cartKeyboardOverlay.hide();this.reLayout()},keyboardChange:function(t){var o=e(t.target?t.target:t),i=+o.attr("data-value"),a=this.cache;if(o[0]===a.$followTimesInput[0])a.$additionForFollowTimes.find("li").removeClass("active").filter('[data-value="'+i+'"]').addClass("active");this.updateInfo()},setFollowTimes:function(t){this.cache.$followTimesInput.attr("data-value",e(t.currentTarget).attr("data-value"));this.keyboardChange(this.cache.$followTimesInput)},setBetTimes:function(t){this.cache.$betTimesInput.attr("data-value",e(t.currentTarget).attr("data-value"));this.keyboardChange(this.cache.$betTimesInput)},checkPeriod:function(){if(this.cache.stopSale){e.alert("当前期次已截止，请等待下期");return false}if(this.cache.nextOpenSecs>0&&this.cache.timeLeft<=0){e.alert("当前期次已截止，请等待下期");return false}if(this.cache.timeLeft<=0)return window.confirm("期次已改变，当前期是"+this.cache.period+"期，确定继续投注？");return true},pay:function(){var t=this;if(this.__payLock__)return;window.setTimeout(function(){t.__payLock__=false},3e3);if(!this.checkPeriod())return;var i={},a=this.cache,l=+a.$followTimesInput.attr("data-value")||1,r=+a.$betTimesInput.attr("data-value")||1,s=this.betPool.getData();if(0===s.length){e.confirm("是否机选一注试试运气？",function(e){if(e)t.betPool.random(1)});return false}i.betTimes=r;if(l>1){i.followTimes=l;i.betWay="ZHUIHAO";i.followName=o.gameCn+" 追号"+l+"期"}i.followMode=e("#stopWhenFeed")[0].checked?1:0;i.stakeNumber=this.betPool.serialize();i.gameEn=o.gameEn;if(this.config.activityType)i.activityType=this.config.activityType;this.addPayPara(i);n.remove(this.config.poolNumKey);a.$followTimesInput.val(1);a.$betTimesInput.val(1);this.__payLock__=true;this.createForm(this.config.payUrl,i)},addPayPara:function(e){return e},createForm:function(t,o,i,a){var n=["<form method='",i||"post","' action='",t,"' target='",a||"_self","'>"],l,r;if(o)for(l in o)n.push("<input type='hidden' name='"+l+"' value='"+o[l]+"'/>");r=e(n.join("")+"</form>").appendTo(document.body);r.submit();r.remove()}})}(window.Zepto,window.Core,window.Game,window.Class);