if(jQuery){(function(a){a.extend(a.fn,{miniColors:function(r,x){var n=function(A,D,C){var z=t(A.val());if(!z){z="FFFFFF"}var y=i(z);var B=a('<a class="miniColors-trigger" style="background-color: #'+z+'" href="#"></a>');B.insertAfter(A);A.addClass("miniColors").attr("maxlength",7).attr("autocomplete","off");A.data("trigger",B);A.data("hsb",y);if(D.change){A.data("change",D.change)}if(D.readonly){A.attr("readonly",true)}if(D.disabled){f(A)}B.bind("click.miniColors",function(o){o.preventDefault();A.trigger("focus")});A.bind("focus.miniColors",function(o){v(A)});A.bind("blur.miniColors",function(E){var o=t(A.val());A.val(o?"#"+o:"")});A.bind("keydown.miniColors",function(o){if(o.keyCode===9){m(A)}});A.bind("keyup.miniColors",function(o){var E=A.val().replace(/[^A-F0-9#]/ig,"");A.val(E);if(!k(A)){A.data("trigger").css("backgroundColor","#FFF")}});A.bind("paste.miniColors",function(o){setTimeout(function(){A.trigger("keyup")},5)})};var w=function(o){m();o=a(o);o.data("trigger").remove();o.removeAttr("autocomplete");o.removeData("trigger");o.removeData("selector");o.removeData("hsb");o.removeData("huePicker");o.removeData("colorPicker");o.removeData("mousebutton");o.removeData("moving");o.unbind("click.miniColors");o.unbind("focus.miniColors");o.unbind("blur.miniColors");o.unbind("keyup.miniColors");o.unbind("keydown.miniColors");o.unbind("paste.miniColors");a(document).unbind("mousedown.miniColors");a(document).unbind("mousemove.miniColors")};var p=function(o){o.attr("disabled",false);o.data("trigger").css("opacity",1)};var f=function(o){m(o);o.attr("disabled",true);o.data("trigger").css("opacity",0.5)};var v=function(A){if(A.attr("disabled")){return false}m();var o=a('<div class="miniColors-selector"></div>');o.append('<div class="miniColors-colors" style="background-color: #FFF;"><div class="miniColors-colorPicker"></div></div>');o.append('<div class="miniColors-hues"><div class="miniColors-huePicker"></div></div>');o.css({top:A.is(":visible")?A.offset().top+A.outerHeight():A.data("trigger").offset().top+A.data("trigger").outerHeight(),left:A.is(":visible")?A.offset().left:A.data("trigger").offset().left,display:"none"}).addClass(A.attr("class"));var z=A.data("hsb");o.find(".miniColors-colors").css("backgroundColor","#"+g({h:z.h,s:100,b:100}));var y=A.data("colorPosition");if(!y){y=d(z)}o.find(".miniColors-colorPicker").css("top",y.y+"px").css("left",y.x+"px");var B=A.data("huePosition");if(!B){B=q(z)}o.find(".miniColors-huePicker").css("top",B.y+"px");A.data("selector",o);A.data("huePicker",o.find(".miniColors-huePicker"));A.data("colorPicker",o.find(".miniColors-colorPicker"));A.data("mousebutton",0);a("BODY").append(o);o.fadeIn(100);o.bind("selectstart",function(){return false});a(document).bind("mousedown.miniColors",function(C){A.data("mousebutton",1);if(a(C.target).parents().andSelf().hasClass("miniColors-colors")){C.preventDefault();A.data("moving","colors");c(A,C)}if(a(C.target).parents().andSelf().hasClass("miniColors-hues")){C.preventDefault();A.data("moving","hues");l(A,C)}if(a(C.target).parents().andSelf().hasClass("miniColors-selector")){C.preventDefault();return}if(a(C.target).parents().andSelf().hasClass("miniColors")){return}m(A)});a(document).bind("mouseup.miniColors",function(C){A.data("mousebutton",0);A.removeData("moving")});a(document).bind("mousemove.miniColors",function(C){if(A.data("mousebutton")===1){if(A.data("moving")==="colors"){c(A,C)}if(A.data("moving")==="hues"){l(A,C)}}})};var m=function(o){if(!o){o=".miniColors"}a(o).each(function(){var y=a(this).data("selector");a(this).removeData("selector");a(y).fadeOut(100,function(){a(this).remove()})});a(document).unbind("mousedown.miniColors");a(document).unbind("mousemove.miniColors")};var c=function(B,D){var A=B.data("colorPicker");A.hide();var y={x:D.clientX-B.data("selector").find(".miniColors-colors").offset().left+a(document).scrollLeft()-5,y:D.clientY-B.data("selector").find(".miniColors-colors").offset().top+a(document).scrollTop()-5};if(y.x<=-5){y.x=-5}if(y.x>=144){y.x=144}if(y.y<=-5){y.y=-5}if(y.y>=144){y.y=144}B.data("colorPosition",y);A.css("left",y.x).css("top",y.y).show();var C=Math.round((y.x+5)*0.67);if(C<0){C=0}if(C>100){C=100}var o=100-Math.round((y.y+5)*0.67);if(o<0){o=0}if(o>100){o=100}var z=B.data("hsb");z.s=C;z.b=o;e(B,z,true)};var l=function(z,B){var C=z.data("huePicker");C.hide();var o={y:B.clientY-z.data("selector").find(".miniColors-colors").offset().top+a(document).scrollTop()-1};if(o.y<=-1){o.y=-1}if(o.y>=149){o.y=149}z.data("huePosition",o);C.css("top",o.y).show();var A=Math.round((150-o.y-1)*2.4);if(A<0){A=0}if(A>360){A=360}var y=z.data("hsb");y.h=A;e(z,y,true)};var e=function(y,o,z){y.data("hsb",o);var A=g(o);if(z){y.val("#"+A)}y.data("trigger").css("backgroundColor","#"+A);if(y.data("selector")){y.data("selector").find(".miniColors-colors").css("backgroundColor","#"+g({h:o.h,s:100,b:100}))}if(y.data("change")){y.data("change").call(y,"#"+A,u(o))}};var k=function(A){var B=t(A.val());if(!B){return false}var z=i(B);var D=A.data("hsb");if(z.h===D.h&&z.s===D.s&&z.b===D.b){return true}var y=d(z);var o=a(A.data("colorPicker"));o.css("top",y.y+"px").css("left",y.x+"px");var E=q(z);var C=a(A.data("huePicker"));C.css("top",E.y+"px");e(A,z,false);return true};var d=function(z){var o=Math.ceil(z.s/0.67);if(o<0){o=0}if(o>150){o=150}var A=150-Math.ceil(z.b/0.67);if(A<0){A=0}if(A>150){A=150}return{x:o-5,y:A-5}};var q=function(o){var z=150-(o.h/2.4);if(z<0){h=0}if(z>150){h=150}return{y:z-1}};var t=function(o){o=o.replace(/[^A-Fa-f0-9]/,"");if(o.length==3){o=o[0]+o[0]+o[1]+o[1]+o[2]+o[2]}return o.length===6?o:null};var u=function(o){var z={};var D=Math.round(o.h);var C=Math.round(o.s*255/100);var y=Math.round(o.b*255/100);if(C==0){z.r=z.g=z.b=y}else{var E=y;var B=(255-C)*y/255;var A=(E-B)*(D%60)/60;if(D==360){D=0}if(D<60){z.r=E;z.b=B;z.g=B+A}else{if(D<120){z.g=E;z.b=B;z.r=E-A}else{if(D<180){z.g=E;z.r=B;z.b=B+A}else{if(D<240){z.b=E;z.r=B;z.g=E-A}else{if(D<300){z.b=E;z.g=B;z.r=B+A}else{if(D<360){z.r=E;z.g=B;z.b=E-A}else{z.r=0;z.g=0;z.b=0}}}}}}}return{r:Math.round(z.r),g:Math.round(z.g),b:Math.round(z.b)}};var b=function(o){var y=[o.r.toString(16),o.g.toString(16),o.b.toString(16)];a.each(y,function(z,A){if(A.length==1){y[z]="0"+A}});return y.join("")};var s=function(o){var o=parseInt(((o.indexOf("#")>-1)?o.substring(1):o),16);return{r:o>>16,g:(o&65280)>>8,b:(o&255)}};var j=function(z){var y={h:0,s:0,b:0};var A=Math.min(z.r,z.g,z.b);var o=Math.max(z.r,z.g,z.b);var B=o-A;y.b=o;y.s=o!=0?255*B/o:0;if(y.s!=0){if(z.r==o){y.h=(z.g-z.b)/B}else{if(z.g==o){y.h=2+(z.b-z.r)/B}else{y.h=4+(z.r-z.g)/B}}}else{y.h=-1}y.h*=60;if(y.h<0){y.h+=360}y.s*=100/255;y.b*=100/255;return y};var i=function(y){var o=j(s(y));if(o.s===0){o.h=360}return o};var g=function(o){return b(u(o))};switch(r){case"readonly":a(this).each(function(){a(this).attr("readonly",x)});return a(this);break;case"disabled":a(this).each(function(){if(x){f(a(this))}else{p(a(this))}});return a(this);case"value":a(this).each(function(){a(this).val(x).trigger("keyup")});return a(this);break;case"destroy":a(this).each(function(){w(a(this))});return a(this);default:if(!r){r={}}a(this).each(function(){if(a(this)[0].tagName.toLowerCase()!=="input"){return}if(a(this).data("trigger")){return}n(a(this),r,x)});return a(this)}}})})(jQuery)};